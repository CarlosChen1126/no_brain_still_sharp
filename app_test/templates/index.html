<!DOCTYPE html>
<html>
<head>
  <title>Camera Zoom & Pan</title>
  <style>
    canvas {
      border: 1px solid black;
      cursor: grab;
    }
  </style>
</head>
<body>
  <h2>Camera Zoom and Pan</h2>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let scale = 1.0;
    let offsetX = 0;
    let offsetY = 0;
    let dragging = false;
    let startX, startY;

    const img = new Image();
    img.src = '/video_feed';

    img.onload = () => {
      canvas.width = 640;
      canvas.height = 480;
      requestAnimationFrame(draw);
    };

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(offsetX, offsetY);
      ctx.scale(scale, scale);
      ctx.drawImage(img, 0, 0);
      ctx.restore();
      requestAnimationFrame(draw);
    }

    canvas.addEventListener('wheel', e => {
      e.preventDefault();
      const factor = 1.1;
      const mouseX = (e.offsetX - offsetX) / scale;
      const mouseY = (e.offsetY - offsetY) / scale;

      if (e.deltaY < 0) scale *= factor;
      else scale /= factor;

      // Fix offset to zoom into mouse point
      offsetX = e.offsetX - mouseX * scale;
      offsetY = e.offsetY - mouseY * scale;
    });

    canvas.addEventListener('mousedown', e => {
      dragging = true;
      startX = e.offsetX - offsetX;
      startY = e.offsetY - offsetY;
    });

    canvas.addEventListener('mousemove', e => {
      if (dragging) {
        offsetX = e.offsetX - startX;
        offsetY = e.offsetY - startY;
      }
    });

    canvas.addEventListener('mouseup', () => dragging = false);
    canvas.addEventListener('mouseleave', () => dragging = false);
  </script>
</body>
</html>

